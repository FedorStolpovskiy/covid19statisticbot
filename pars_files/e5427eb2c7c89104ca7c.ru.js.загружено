(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([["geolocation","dialog"],{121:function(e,t,o){"use strict";o.d(t,"a",function(){return i});var n=o(65),r=Object(n.a)("mapFeatureGroup",{}),a=r.connect,i=r.Provider;t.b=a},1301:function(e,t,o){"use strict";o.r(t);var n=o(6),r=o(10),a=o(4),i=o(11),c=o(14),s=o(19),l=o(425),u=o(819),d=o(22),p=(o(1576),o(7)),m=o(34),g=o(8),_=o(9),v=o(30),f=(o(830),o(32)),h=o(33),E=Object(p.a)("geolocation-pin"),b=(v.a.minimum,function(e){function t(){return e.apply(this,arguments)||this}return Object(n.a)(t,e),t.prototype.render=function(){var e=this.props,t=Object(h.g)(e.config)?"map-placemark-dot-ru":"map-placemark-dot";return a.createElement(a.Fragment,null,a.createElement(_.a,{name:"geolocation_pin"},a.createElement(m.default,{coordinates:e.currentPosition,zIndex:v.a.minimum,nonInteractive:!0},a.createElement("div",{className:E("placemark")},a.createElement(f.a,{name:t,size:32})))),null)},t}(a.Component)),y=Object(g.b)(b),C=(o(1578),o(44)),k=o(15),w=o(36),S=o(66),I=o.n(S),P=Object(p.a)("geolocation-error-dialog"),O=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._renderShutter=function(e){var o=t.props;return a.createElement(I.a,{isShown:o.isShown,onClose:o.onClose,swipeable:!0},e)},t._renderDialog=function(e){var o=t.props;return a.createElement(C.default,{onClose:o.onClose,isOpen:o.isShown},e)},t._renderCloseButton=function(){var e=t.props;return a.createElement(_.a,{name:"close",logClick:!0},a.createElement(w.a,{onClick:e.onClose,offset:"large",circle:!0}))},t._renderDeniedMessage=function(){var e=t.props;return a.createElement(a.Fragment,null,a.createElement("div",{className:P("title")},"Карты не знают, где вы находитесь"),a.createElement("div",{className:P("text")},"Разрешите им определять ваше местоположение: это делается в настройках устройства"),a.createElement("div",{className:P("controls")},a.createElement("div",{className:P("controls-item")},a.createElement(_.a,{name:"open_guide",logClick:!0},a.createElement(k.a,{view:"primary",size:"small",url:e.config.feedback.geolocationHelpUrl,target:"_blank"},"Посмотреть инструкцию"))),a.createElement(_.a,{name:"next_time",logClick:!0},a.createElement("a",{className:P("next-time-button"),onClick:e.onClose},"Не сейчас"))))},t._renderUnavailableMessage=function(){var e=t.props;return a.createElement(a.Fragment,null,a.createElement("div",{className:P("title")},"Что-то пошло не так"),a.createElement("div",{className:P("text")},"Не удалось определить местоположение.\n\nПроверьте настройки браузера и повторите попытку."),a.createElement("div",{className:P("controls")},a.createElement(_.a,{name:"back",logClick:!0},a.createElement(k.a,{isStretched:!0,view:"primary",size:"small",onClick:e.onClose},"Вернуться к карте"))))},t}return Object(n.a)(t,e),t.prototype.render=function(){var e="permission_denied"===this.props.type;return(0,this._renderDialog)(a.createElement(_.a,{name:"error_dialog"},a.createElement("div",{className:P()},this._renderCloseButton(),e?this._renderDeniedMessage():this._renderUnavailableMessage())))},t}(a.Component),M=Object(g.b)(O),D={startGeolocation:d.a.startGeolocation,stopGeolocation:d.a.stopGeolocation,setGeolocationWatching:d.a.setGeolocationWatching,setGeolocationError:d.a.setGeolocationError,setCurrentPosition:d.a.setCurrentPosition,setMapLocation:d.a.setMapLocation,setFollowingPin:d.a.setFollowingPin},T=Object(c.a)(i.b(function(e){return Object(r.a)({config:e.config,center:e.map.location.center,zoom:e.map.location.zoom},e.geolocation)},D),l.b),j=16,G=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._watchPositionId=0,t._createGetPositionAction=function(){var e=t.props;t._getPositionAction=s.a.create(u.a.getCurrentPosition(e.rootNode,e.config),{success:t._onGeolocationSuccess,fail:function(t){return e.setGeolocationError(u.a.ERROR_TYPES[t.code])},always:function(){return e.stopGeolocation()}})},t._startWatchGeolocation=function(){var e=t.props;e.isWatching||e.setGeolocationWatching(!0),t._watchPositionId=u.a.watchPosition({onSuccess:t._onWatchGeolocationSuccess,onError:function(o){e.setGeolocationError(o),e.setGeolocationWatching(!1),t._stopWatchGeolocation()}},e.rootNode,e.config,3e3)},t._onGeolocationSuccess=function(e){if(e){var o=[e.longitude,e.latitude];t.props.setCurrentPosition(o,e.accuracy),t._applyPosition(o,e.accuracy)}},t._onWatchGeolocationSuccess=function(e){if(e){var o=[e.longitude,e.latitude];t.props.setCurrentPosition(o,e.accuracy)}},t._stopWatchGeolocation=function(){u.a.clearWatch(t._watchPositionId),t._watchPositionId=0},t._applyPosition=function(e,o){var n,r=t.props;r.isAuto||t._zoomingTimer||(o<200&&r.zoom<j&&(n=j,t._zoomingTimer=window.setTimeout(function(){return t._zoomingTimer=void 0},1e3)),r.setMapLocation({center:e,zoom:n,duration:350}))},t._onErrorCloseClick=function(){t.props.setGeolocationError(null)},t._renderError=function(){var e=t.props,o=Boolean(e.error&&!e.isAuto);return a.createElement(M,{isShown:o,type:e.error,onClose:t._onErrorCloseClick})},t._renderPlacemark=function(){var e=t.props;return e.currentPosition&&void 0!==e.accuracy?a.createElement(y,{currentPosition:e.currentPosition,accuracy:e.accuracy}):null},t}Object(n.a)(t,e);var o=t.prototype;return o.componentDidMount=function(){var e=this;this.props.config;this.props.isStarted?this._createGetPositionAction():this._checkPermissionAction=s.a.create(u.a.checkPermission(),{success:function(t){"granted"===t&&e.props.startGeolocation({isAuto:!0})}})},o.componentDidUpdate=function(e){!e.isStarted&&this.props.isStarted&&(s.a.cancel(this._getPositionAction),this._createGetPositionAction())},o.componentWillUnmount=function(){s.a.cancel(this._getPositionAction),s.a.cancel(this._checkPermissionAction),this._stopWatchGeolocation(),window.clearTimeout(this._zoomingTimer),this._zoomingTimer=void 0},o.render=function(){return a.createElement(a.Fragment,null,this._renderPlacemark(),this._renderError())},t}(a.PureComponent);t.default=T(G)},1576:function(e,t,o){},1578:function(e,t,o){},30:function(e,t,o){"use strict";o.d(t,"a",function(){return n});var n={screenshotDialog:99999,ruler:8030,editing:8030,hover:8020,active:8e3,search:{active:8e3,subtitle:7500,title:7e3,base:6500,dot:6e3},dialog:2e3,usermaps:{placemark:3e3,line:2e3,polygon:1e3},discovery:580,routes:550,routePins:{waypoint:8e3,masstransit:7900},masstransitStop:8001,moving:500,masstransitLineStop:510,home:451,work:450,default:400,tooltip:352,masstransitRegion:350,bookmarks:300,minimum:1}},34:function(e,t,o){"use strict";o.r(t);var n=o(87),r=o(6),a=(o(71),o(4)),i=o(5),c=o(7),s=o(31),l=o(30),u=o(62),d=300,p=Object(c.a)("map-placemark"),m=function(){},g=function(e){function t(t){var o;return(o=e.call(this,t)||this)._container=document.createElement("div"),o._isDragged=!1,o._initCursor=function(){o._updateCursor(),o._marker.group().on("dragStart",function(){o._isDragged=!0,o._container.style.cursor="grabbing",o.props.map.container.style.cursor="grabbing"}).on("dragEnd",function(){o._isDragged=!1,o._updateCursor(),o.props.map.container.style.cursor="default"})},o._updateCursor=function(){o._container.style.cursor=o.props.onClick||o.props.onMouseEnter||o.props.draggable?"pointer":"default"},o._addMapEventHandlers=function(e){var t={dragStart:e.onDragStart,dragMove:e.onDragMove,dragEnd:e.onDragEnd};Object.keys(t).forEach(function(e){t[e]&&o._mapEventHandlers.on(e,function(){t[e]({coordinates:o._marker.coordinates})})})},o._onClick=function(e){e.stopPropagation();var t=o.props,n=t.onClick||m,r=t.onFastClick||m,a=t.onDoubleClick||m;o._clickTimer?(a(),window.clearTimeout(o._clickTimer),o._clickTimer=void 0):(r(),o._clickTimer=window.setTimeout(function(){n(),o._clickTimer=void 0},d))},o._container.className=p(),o._marker=t.map.createMarker({coordinates:t.coordinates,element:o._container,options:{draggable:t.draggable,zIndex:t.zIndex||l.a.default,disableRoundCoordinates:t.disableRoundCoordinates,blockEvents:t.blockEvents}}),o._mapEventHandlers=o._marker.group(),o}Object(r.a)(t,e);var o=t.prototype;return o.componentDidMount=function(){var e=this.props;this._initCursor(),this._addMapEventHandlers(e),e.map.addMarker(this._dataSourceId,this._marker)},o.componentWillUnmount=function(){this.props.map.destroyed||(this._mapEventHandlers.offAll(),this.props.map.removeMarker(this._dataSourceId,this._marker),this._marker.destroy(),this._isDragged&&(this.props.map.container.style.cursor="default")),window.clearTimeout(this._clickTimer)},o.componentDidUpdate=function(e){var t=e.dataSourceId?e.dataSourceId:u.d.DEFAULT_MARKERS;t!==this._dataSourceId&&(this.props.map.removeMarker(t,this._marker),this.props.map.addMarker(this._dataSourceId,this._marker));var o=this.props;o.coordinates!==e.coordinates&&this._marker.setCoordinates(o.coordinates),e.draggable!==o.draggable&&this._marker.toggleDrag(o.draggable||!1),e.zIndex!==o.zIndex&&this._marker.setZIndex(o.zIndex||l.a.default),e.disableRoundCoordinates!==o.disableRoundCoordinates&&this._marker.toggleRoundCoordinates(o.disableRoundCoordinates||!1),o.onDragStart===e.onDragStart&&o.onDragMove===e.onDragMove&&o.onDragEnd===e.onDragEnd||(this._mapEventHandlers.offAll(),this._addMapEventHandlers(o)),e.draggable===o.draggable&&e.onClick===o.onClick||this._updateCursor()},o.render=function(){var e=this.props,t=a.createElement("div",{className:p("wrapper",{"non-interactive":e.nonInteractive}),onClick:this._onClick,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onMouseMove:e.onMouseMove},e.children);return i.createPortal(t,this._container)},Object(n.a)(t,[{key:"_dataSourceId",get:function(){return this.props.dataSourceId||u.d.DEFAULT_MARKERS}}]),t}(a.PureComponent);t.default=Object(s.b)({shouldWait:!0})(g)},44:function(e,t,o){"use strict";o.r(t);var n=o(6),r=(o(58),o(4)),a=o(7),i=o(35),c=o(88),s=o(8),l=o(57),u=o(36),d=o(56),p=o(9),m=Object(a.a)("dialog"),g=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._container=r.createRef(),t._ref=r.createRef(),t._focusContainer=function(){if(t._container.current&&(!window.document.activeElement||!t._container.current.contains(window.document.activeElement))){var e=t._ref.current.scrollTop;t._container.current.focus(),t._ref.current.scrollTop=e}},t._onClose=function(){t.props.onClose()},t._onMouseDown=function(e){var o=e.currentTarget,n=!!(o.scrollHeight>o.offsetHeight)&&o.offsetWidth===o.clientWidth?15:0;e.target===e.currentTarget&&e.clientX+n<e.currentTarget.clientWidth&&t._onClose()},t._onScroll=function(){var e=t._ref.current,o=e.clientHeight+e.scrollTop>=e.scrollHeight;t.props.onScrollToEnd&&o&&t.props.onScrollToEnd()},t._renderClose=function(){if(!t.props.showCloseButton)return null;var e=Boolean(!1);return r.createElement(p.a,{name:"close",useParentState:!0,logClick:!0},r.createElement(u.a,{onClick:t._onClose,offset:e?"small":"large",circle:!0,usePortal:!1}))},t._renderContainer=function(){var e=t.props,o=Boolean(!1);return r.createElement("div",{className:m("container"),ref:t._container,tabIndex:1},r.createElement(c.a,{handlers:{key:l.a.ESC,callback:t._onClose,allowInEditable:!0},stopPropagation:!0}),r.createElement("div",{className:m("content",{"with-title":o})},o?r.createElement(i.a,{selector:".body"},r.createElement("div",{className:m("title")},e.mobileTitle)):null,t._renderClose(),e.children))},t._renderDialog=function(){var e=t.props;return r.createElement(p.a,{name:"dialog",useParentState:!0,logClick:!0},r.createElement(r.Fragment,null,r.createElement("div",{className:m({transparent:e.transparent,fullscreen:e.fullscreen,"fit-mobile-content":e.fitMobileContent}),style:e.zIndex?{zIndex:e.zIndex}:void 0,ref:t._ref,onMouseDown:t._onMouseDown,onTouchMove:function(e){return e.preventDefault()},onScroll:t.props.onScrollToEnd?t._onScroll:void 0},t._renderContainer()),r.createElement("div",{className:m("paranja"),style:e.zIndex?{zIndex:e.zIndex-1}:void 0})))},t}Object(n.a)(t,e);var o=t.prototype;return o.componentDidMount=function(){this.props.isOpen&&this._focusContainer()},o.componentDidUpdate=function(e){!e.isOpen&&this.props.isOpen&&this._focusContainer()},o.render=function(){var e=this.props,t=e.isOpen?this._renderDialog():null;return e.inline?r.createElement(d.a,{onHideEnd:e.onHideEnd},t):r.createElement(i.a,{selector:".body"},r.createElement(d.a,{onHideEnd:e.onHideEnd},t))},t}(r.Component);t.default=Object(s.b)(g)},58:function(e,t,o){},594:function(e,t,o){"use strict";function n(e){if(0===e.length)return[];for(var t=[e[0]],o=0,n=e[0],r=1;r<e.length;r++){var a=e[r],i=a[0]+o-n[0];if(i>360||i<-360){var c=360*Math.floor(i/360);o-=c,i-=c}i>180?o-=360:i<-180&&(o+=360);var s=[a[0]+o,a[1]];t.push(s),n=s}return t}o.d(t,"a",function(){return n})},66:function(e,t){},71:function(e,t,o){},819:function(e,t,o){"use strict";var n=o(10),r=o(105),a=o(151),i=["","permission_denied","position_unavailable","timeout"],c=function(e){this.message=e,this.code=i.indexOf(e)},s=6e4,l={ERROR_TYPES:i,getCurrentPosition:function(e,t,o){var n,r;return void 0===o&&(o=s),"denied"===(null===(n=t.query.mocks)||void 0===n?void 0:n.geolocation)?Promise.reject({code:1}):"unavailable"===(null===(r=t.query.mocks)||void 0===r?void 0:r.geolocation)?Promise.reject({code:2}):(e.logEvent("geolocation_request"),d({timeout:o}).then(function(o){var n,r,a=o.coords;e.logEvent("geolocation_success",{accuracy:a.accuracy});var i=m(null===(n=t.query.mocks)||void 0===n?void 0:n.geolocation),c=i?{accuracy:null!==(r=i.accuracy)&&void 0!==r?r:a.accuracy,latitude:i.latitude,longitude:i.longitude,altitude:null,altitudeAccuracy:null,heading:null,speed:null}:a;return u(c,t),c}).catch(function(t){throw e.logEvent("geolocation_fail",{type:l.ERROR_TYPES[t.code]}),t}))},watchPosition:function(e,t,o,r){var a,i;if(void 0===r&&(r=s),"denied"===(null===(a=o.query.mocks)||void 0===a?void 0:a.geolocation))return e.onError("permission_denied"),0;if("unavailable"===(null===(i=o.query.mocks)||void 0===i?void 0:i.geolocation))return e.onError("position_unavailable"),0;t.logEvent("geolocation_watch_request");var c,p,g,_,v,f,h=!1;return c=function(n){var r,a;h||(t.logEvent("geolocation_watch_success",{accuracy:n.coords.accuracy}),h=!0);var i=m(null===(r=o.query.mocks)||void 0===r?void 0:r.geolocation),c=i?{accuracy:null!==(a=i.accuracy)&&void 0!==a?a:n.coords.accuracy,latitude:i.latitude,longitude:i.longitude,altitude:null,altitudeAccuracy:null,heading:null,speed:null}:n.coords;u(c,o),e.onSuccess(c)},p=function(o){var n=l.ERROR_TYPES[o.code];h||(t.logEvent("geolocation_watch_fail",{type:n}),h=!0),e.onError(n)},g={timeout:r},(null===(_=window.yandex)||void 0===_?void 0:null===(v=_.mapsApp)||void 0===v?void 0:v.getCurrentUserLocation)?window.setInterval(function(){return d(g).then(c).catch(p)},null!==(f=null==g?void 0:g.timeout)&&void 0!==f?f:s):window.navigator.geolocation.watchPosition(c,p,Object(n.a)({enableHighAccuracy:!0},g))},clearWatch:function(e){var t,o;(null===(t=window.yandex)||void 0===t?void 0:null===(o=t.mapsApp)||void 0===o?void 0:o.getCurrentUserLocation)?window.clearInterval(e):window.navigator.geolocation.clearWatch(e)},checkPermission:function(){return window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(function(e){return e.state}):Promise.resolve(void 0)}};function u(e,t){e&&(e.accuracy>5e3||((new window.Image).src=t.morda.url+"/gpsave?"+r.stringify({sk:t.xscriptCsrfToken,lat:e.latitude,lon:e.longitude,precision:e.accuracy})))}function d(e){var t,o,r,i=null===(t=window.yandex)||void 0===t?void 0:null===(o=t.mapsApp)||void 0===o?void 0:o.getCurrentUserLocation;return i?Promise.race([i().then(function(e){return"string"==typeof e?JSON.parse(e):e}).catch(function(){throw new c("position_unavailable")}),a.a(null!==(r=null==e?void 0:e.timeout)&&void 0!==r?r:s).then(function(){throw new c("timeout")})]):new Promise(function(t,o){return window.navigator.geolocation.getCurrentPosition(t,o,Object(n.a)({enableHighAccuracy:!0},e))})}var p=/^\d+\.?(\d+)?,\d+\.?(\d+)?(,\d+)?$/;function m(e){if(p.test(e)){var t=e.split(",").map(Number);return{latitude:t[0],longitude:t[1],accuracy:t[2]}}}t.a=l},830:function(e,t,o){"use strict";var n=o(6),r=o(4),a=o(182),i=o(232),c=o(1364),s=o(2982),l=o(379),u=o(2977),d=o(91),p=o(594),m=(a.j,Math.PI,function(e){function t(t){var o;return(o=e.call(this,t)||this)._getGeometry=function(){var e=o.props;e.radius;for(var t=Object(i.a)(e.center,2),n=Object(c.a)(e.center,[-1,0],e.radius).endPoint,r=Object(s.a)(Object(i.a)(n,2),t),a=[],u=0;u<=2*Math.PI;u+=Math.PI/40){var d=[t[0]+Math.cos(u)*r,t[1]+Math.sin(u)*r];a.push(Object(l.a)(d,2))}return{type:"Polygon",coordinates:[Object(p.a)(a)]}},o.state={geometry:o._getGeometry()},o}Object(n.a)(t,e);var o=t.prototype;return o.componentDidUpdate=function(e){var t=this.props;Object(u.a)(t.center,e.center)&&t.radius===e.radius||this.setState({geometry:this._getGeometry()})},o.render=function(){return r.createElement(d.a,{geometry:this.state.geometry,drawingStyle:this.props.drawingStyle})},t}(r.PureComponent));t.a=m},91:function(e,t,o){"use strict";var n=o(87),r=o(6),a=o(4),i=o(52),c=o.n(i),s=o(31),l=o(2983),u=o(62),d=o(121),p=o(14),m={onClick:"click",onFastClick:"fastclick",onTouchEnd:"touchend",onDoubleClick:"dblclick",onMouseEnter:"mouseenter",onMouseLeave:"mouseleave",onMouseUp:"mouseup",onMouseDown:"mousedown",onMouseMove:"mousemove"},g=Object(p.a)(d.b,Object(s.b)({shouldWait:!0})),_=function(e){function t(t){var o;return(o=e.call(this,t)||this)._handlers={},o._getFeature=function(){return{type:"Feature",id:o._id,geometry:o.props.geometry}},o._addHandler=function(e,t,n){o._handlers[e]=function(e,t,r){e&&"feature"===e.type&&e.feature.id===o._id&&n(r,t)},o.props.map.events.on(m[e],t,o._handlers[e])},o._removeHandler=function(e,t){o.props.map.events.off(m[e],t,o._handlers[e]),delete o._handlers[e]},o._id=t.id||c.a.v4(),o}Object(r.a)(t,e);var o=t.prototype;return o.componentDidMount=function(){var e=this,t=this.props;t.map.addFeature(this._dataSourceId,this._getFeature(),t.drawingStyle,t.parentGroupId),Object.keys(m).forEach(function(o){t[o]&&e._addHandler(o,e._dataSourceId,t[o])})},o.componentDidUpdate=function(e){var t=this,o=this.props,n=e.dataSourceId?e.dataSourceId:u.d.DEFAULT_GRAPHICS;n!==this._dataSourceId?(o.map.removeFeatureById(n,this._id),o.map.addFeature(this._dataSourceId,this._getFeature(),o.drawingStyle,o.parentGroupId)):((!Object(l.a)(e.drawingStyle,o.drawingStyle)||!Object(l.a)(e.geometry,o.geometry))&&o.map.updateFeature(this._dataSourceId,this._getFeature(),o.drawingStyle),e.parentGroupId!==o.parentGroupId&&o.map.moveFeatureToGroup(this._dataSourceId,this._getFeature().id,o.parentGroupId));Object.keys(m).forEach(function(r){o[r]===e[r]&&n===t._dataSourceId||(e[r]&&t._removeHandler(r,n),o[r]&&t._addHandler(r,t._dataSourceId,o[r]))})},o.componentWillUnmount=function(){var e=this;Object.keys(this._handlers).forEach(function(t){return e._removeHandler(t,e._dataSourceId)}),this.props.map.removeFeatureById(this._dataSourceId,this._id)},o.render=function(){return null},Object(n.a)(t,[{key:"_dataSourceId",get:function(){return this.props.dataSourceId||u.d.DEFAULT_GRAPHICS}}]),t}(a.PureComponent);t.a=g(_)}}]);