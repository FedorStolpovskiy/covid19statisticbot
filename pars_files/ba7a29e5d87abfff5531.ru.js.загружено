(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([["tilt-rotate-control"],{1211:function(t,e,a){"use strict";a.r(e);var o=a(6),n=(a(2432),a(4)),i=a(233),r=a(7),s=a(64),l=a(31),c=a(12),p=a(733),m=a(8),u=a(9),_=a(1314),d=a(2434),v=a.n(d),f=Object(r.a)("map-geolocation-rotate-control"),h=function(t){function e(e){var a;return(a=t.call(this,e)||this)._analyticsRef=n.createRef(),a._onMapUpdate=function(){a.state.azimuth!==a.props.map.azimuth&&a.setState({azimuth:a.props.map.azimuth})},a._onMapMainEngineChanged=function(){var t="vector"===a.props.map.getEffectiveMode();t!==a.state.isVector&&a.setState({isVector:t})},a._onResetMapRotate=function(){var t=a.state.azimuth;Object(p.c)(a.props.map,function(){var e;null===(e=a._analyticsRef.current)||void 0===e||e.logEvent("reset",{start_azimuth:Object(i.a)(t)})})},a.state={azimuth:e.map.azimuth,isVector:"vector"===e.map.getEffectiveMode()},a}return Object(o.a)(e,t),e.prototype.render=function(){var t=this.state.isVector,e=this.state.azimuth;return n.createElement(n.Fragment,null,n.createElement(u.a,{name:"compass",nodeRef:this._analyticsRef},0!==e&&t?n.createElement("div",{className:f(),onClick:this._onResetMapRotate,style:{transform:"rotate("+e+"rad)"}},n.createElement(c.a,{url:v.a})):null),0===e?n.createElement(_.a,null):null,n.createElement(s.default,{onUpdate:this._onMapUpdate,onMainEngineChanged:this._onMapMainEngineChanged}))},e}(n.Component);e.default=Object(m.b)(Object(l.b)({shouldWait:!0})(h))},1212:function(t,e,a){"use strict";a.r(e);var o=a(6),n=a(2440),i=a.n(n),r=a(4),s=a.n(r),l=a(7),c=a(26),p=a(64),m=a(31),u=a(62),_=a(43),d=a(733),v=a(15),f=a(9),h=a(233),E=a(8),g=Object(c.a)({resolved:{},chunkName:function(){return"tooltip"},isReady:function(t){var e=this.resolve(t);return!1!==this.resolved[e]&&!!a.m[e]},importAsync:function(){return a.e("tooltip").then(a.bind(null,276))},requireAsync:function(t){var e=this,a=this.resolve(t);return this.resolved[a]=!1,Promise.resolve(this.importAsync(t)).then(function(t){return e.resolved[a]=!0,t})},requireSync:function t(e){var o=this.resolve(e);return a(o)},resolve:function t(){return 276}}),b=3,M=Object(l.a)("map-tilt-rotate-control"),R=function(t){function e(e){var a;return(a=t.call(this,e)||this)._controlRef=r.createRef(),a._tooltipTargetRef=r.createRef(),a._analyticsCompassRef=r.createRef(),a._analyticsTiltRef=r.createRef(),a._startTilt=d.a,a._isClick=!1,a._startAzimuth=0,a._isMovementEnabled=!0,a._recalculateCenter=function(){if(a._controlRef.current){var t=a._controlRef.current.getBoundingClientRect(),e=t.x,o=t.y,n=t.height,i=t.width;a._controlCenterPosition={x:e+i/2,y:o+n/2}}},a._onMapUpdate=function(){var t;a._isClick||a.props.map.tilt===a.state.tilt&&a.props.map.azimuth===a.state.azimuth||(null===(t=a._tooltipTargetRef.current)||void 0===t||t.click());var e=a._prevZoom,o=a.props.map.zoom,n=a.state.tilt;o<d.b&&e&&e>=d.b&&n!==d.a&&Object(d.d)(a.props.map),a._prevZoom=a.props.map.zoom,a.setState({azimuth:a.props.map.azimuth,tilt:a.props.map.tilt,isTiltDisabled:a.props.map.zoom<d.b})},a._onMapMainEngineChanged=function(){var t="vector"===a.props.map.getEffectiveMode();t!==a.state.isVector&&a.setState({isVector:t})},a._addRotateEventListeners=function(){window.addEventListener("mousemove",a._onRotateMove),window.addEventListener("mouseup",a._onRotateEnd)},a._removeRotateEventListeners=function(){window.removeEventListener("mousemove",a._onRotateMove),window.removeEventListener("mouseup",a._onRotateEnd)},a._addTiltEventListeners=function(){window.addEventListener("mousemove",a._onTiltMove),window.addEventListener("mouseup",a._onTiltEnd)},a._removeTiltEventListeners=function(){window.removeEventListener("mousemove",a._onTiltMove),window.removeEventListener("mouseup",a._onTiltEnd)},a._onRotateStart=function(t){if(0===t.button&&a._isMovementEnabled){a._isClick=!0,a.setState({isMove:!0});var e=a._controlRef.current.getBoundingClientRect(),o=e.x,n=e.y,i=e.height,r=e.width;a._controlCenterPosition={x:o+r/2,y:n+i/2},a._startMovePosition={x:t.clientX,y:t.clientY},a._startAzimuth=a.state.azimuth,a._recalculateCenter(),a._addRotateEventListeners()}},a._onRotateMove=function(t){var e=a._controlCenterPosition,o=e.x,n=e.y,i=a._startMovePosition,r=Math.atan2(t.pageY-n,t.pageX-o)-Math.atan2(i.y-n,i.x-o);a._isClick=!1,a.props.map.setCamera({worldCenter:a.props.map.worldCenter,zoom:a.props.map.zoom,azimuth:a._startAzimuth+r,tilt:a.props.map.tilt})},a._onRotateEnd=function(){var t;(a.setState({showTooltip:!0,isMove:!1}),a._removeRotateEventListeners(),a._isClick)||(null===(t=a._analyticsCompassRef.current)||void 0===t||t.changeState({action_type:"drag",rotation_angle_state:Object(h.a)(a.props.map.azimuth),rotation_angle_diff:Object(h.a)(a.props.map.azimuth-a._startAzimuth)}))},a._toggleMapRotate=function(){a._isClick&&a._isMovementEnabled&&(a._isMovementEnabled=!1,Object(d.c)(a.props.map,function(){var t;a._isClick=!1,a._isMovementEnabled=!0,null===(t=a._analyticsCompassRef.current)||void 0===t||t.changeState({action_type:"click",rotation_angle_state:Object(h.a)(a.props.map.azimuth),rotation_angle_diff:Object(h.a)(a.props.map.azimuth-a._startAzimuth)})}))},a._onTiltStart=function(t){0===t.button&&a._isMovementEnabled&&(a._isClick=!0,a.setState({isMove:!0}),a._startMovePosition={x:t.clientX,y:t.clientY},a._startTilt=a.props.map.tilt,a._addTiltEventListeners())},a._onTiltMove=function(t){var e=a._startMovePosition.y-t.clientY;if(!(Math.abs(e)<b)){var o=Math.PI*e/a.props.map.size.y;a._isClick=!1,a.props.map.setCamera({worldCenter:a.props.map.worldCenter,zoom:a.props.map.zoom,azimuth:a.props.map.azimuth,tilt:a._startTilt+o})}},a._onTiltEnd=function(){var t;(a.setState({showTooltip:!0,isMove:!1}),a._removeTiltEventListeners(),a._isClick)||(null===(t=a._analyticsTiltRef.current)||void 0===t||t.changeState({action_type:"drag",rotation_angle_state:Object(h.a)(a.props.map.tilt),rotation_angle_diff:Object(h.a)(a.props.map.tilt-a._startTilt)}))},a._toggleMapTilt=function(){a._isClick&&a._isMovementEnabled&&(a._isMovementEnabled=!1,Object(d.d)(a.props.map,function(){var t;a._isClick=!1,a._isMovementEnabled=!0,null===(t=a._analyticsTiltRef.current)||void 0===t||t.changeState({action_type:"click",rotation_angle_state:Object(h.a)(a.props.map.tilt),rotation_angle_diff:Object(h.a)(a.props.map.tilt-a._startTilt)})}))},a._isTiltRotateAllowed=function(){var t=a.state.isVector,e=a.props.map.getLayers().topRasterLayers;return t&&e.every(function(t){return!u.c.includes(t.split(":")[0])})},a.state={azimuth:e.map.azimuth,tilt:e.map.tilt,isMove:!1,showTooltip:!1,isTiltDisabled:e.map.zoom<d.b,isVector:"vector"===e.map.getEffectiveMode()},a}Object(o.a)(e,t);var a=e.prototype;return a.componentWillUnmount=function(){this._removeRotateEventListeners(),this._removeTiltEventListeners()},a.render=function(){var t,e=this.state,a=this.props,o=this._isTiltRotateAllowed(),n=e.azimuth,i=e.tilt,s=e.isMove,l=e.isTiltDisabled;t=l?"Увеличьте масштаб, чтобы наклонить карту":i!==d.a?"Убрать наклон карты":"Наклонить карту";var c="MacOS"===a.config.uatraits.OSFamily?"Чтобы повернуть карту, покрутите компас или зажмите Cmd с левой кнопкой мыши":"Чтобы повернуть карту, покрутите компас или зажмите Ctrl с левой кнопкой мыши";return r.createElement(r.Fragment,null,o?r.createElement(r.Fragment,null,r.createElement("div",{className:M({"in-action":s}),ref:this._controlRef},r.createElement(f.a,{name:"compass",nodeRef:this._analyticsCompassRef},r.createElement(_.a,{text:0!==n?"Вернуть север сверху":"Повернуть карту",position:"left",isAir:!0,delay:500,isDisabled:s},r.createElement("div",null,r.createElement("div",{className:M("ring"),style:{transform:"rotate("+n+"rad)"},onClick:this._toggleMapRotate,onMouseDown:this._onRotateStart})))),r.createElement(f.a,{name:"tilt_control",nodeRef:this._analyticsTiltRef},r.createElement(_.a,{text:t,position:"left",isAir:!0,delay:500,isDisabled:s,offset:{main:12,side:0}},r.createElement("div",{className:M("tilt-wrapper")},r.createElement("div",{className:M("tilt",{tilted:i!==d.a,disabled:l}),style:{transform:"rotateX("+i+"rad)"},onClick:l?void 0:this._toggleMapTilt,onMouseDown:l?void 0:this._onTiltStart},i===d.a?"3D":"2D"))))),this.state.showTooltip?r.createElement(g,{title:c,id:"tilt-rotate",showArrow:!1,position:"bottom",offset:{main:15,side:-15},renderControls:function(t){return r.createElement(v.a,{view:"secondary-blue",size:"small",onClick:t},"Понятно")},checkTargetVisibility:!1},r.createElement("div",{ref:this._tooltipTargetRef})):null):null,r.createElement(p.default,{onUpdate:this._onMapUpdate,onMainEngineChanged:this._onMapMainEngineChanged}))},e}(r.Component);e.default=Object(m.b)({shouldWait:!0})(Object(E.b)(R))},1213:function(t,e,a){"use strict";a.r(e);var o=a(6),n=(a(2442),a(4)),i=a(7),r=a(64),s=a(31),l=a(15),c=a(733),p=a(9),m=a(233),u=a(8),_=Object(i.a)("map-tilt-control"),d=function(t){function e(e){var a;return(a=t.call(this,e)||this)._analyticsRef=n.createRef(),a._minZoomTiltAllowed=c.b,a._onMapUpdate=function(){Boolean(a.props.map.zoom<a._minZoomTiltAllowed&&a._prevZoom&&a._prevZoom>=a._minZoomTiltAllowed&&a.state.tilt!==c.a)&&Object(c.d)(a.props.map),a._prevZoom=a.props.map.zoom,a.state.tilt!==a.props.map.tilt&&a.setState({tilt:a.props.map.tilt})},a._onMapMainEngineChanged=function(){var t="vector"===a.props.map.getEffectiveMode();t!==a.state.isVector&&a.setState({isVector:t})},a._onResetMapTilt=function(){var t=a.state.tilt;Object(c.d)(a.props.map,function(){var e;null===(e=a._analyticsRef.current)||void 0===e||e.logEvent("reset",{start_tilt:Object(m.a)(t)})})},a.state={tilt:e.map.tilt,isVector:"vector"===e.map.getEffectiveMode()},a}return Object(o.a)(e,t),e.prototype.render=function(){var t=this.state;return n.createElement(n.Fragment,null,n.createElement(p.a,{name:"tilt_control",nodeRef:this._analyticsRef},t.tilt>c.a&&t.isVector?n.createElement("div",{className:_()},n.createElement(l.a,{view:"air",size:"medium",onClick:this._onResetMapTilt},"2D")):null),n.createElement(r.default,{onUpdate:this._onMapUpdate,onMainEngineChanged:this._onMapMainEngineChanged}))},e}(n.Component);e.default=Object(s.b)({shouldWait:!0})(Object(u.b)(d))},2432:function(t,e,a){},2434:function(t,e,a){t.exports=a.p+"_/d2c114a714e31225540623b8a901aa2a.svg"},2440:function(t,e,a){},2442:function(t,e,a){}}]);